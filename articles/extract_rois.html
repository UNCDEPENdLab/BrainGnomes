<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Extracting ROI Timeseries and Connectivity • BrainGnomes</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Extracting ROI Timeseries and Connectivity">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">BrainGnomes</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/braingnomes_quickstart.html">BrainGnomes Quickstart</a></li>
    <li><a class="dropdown-item" href="../articles/building_containers.html">Building Singularity containers for BrainGnomes</a></li>
    <li><a class="dropdown-item" href="../articles/extract_rois.html">Extracting ROI Timeseries and Connectivity</a></li>
    <li><a class="dropdown-item" href="../articles/postprocessing.html">BrainGnomes Postprocessing Walkthrough</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/UNCDEPENdLab/BrainGnomes/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Extracting ROI Timeseries and Connectivity</h1>
                        <h4 data-toc-skip class="author">Michael
Hallquist</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/UNCDEPENdLab/BrainGnomes/blob/main/vignettes/extract_rois.Rmd" class="external-link"><code>vignettes/extract_rois.Rmd</code></a></small>
      <div class="d-none name"><code>extract_rois.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The <code><a href="../reference/extract_rois.html">extract_rois()</a></code> function summarises postprocessed
BOLD data within atlas‑defined regions and can also compute ROI‑to‑ROI
connectivity matrices. It is typically run after postprocessing
completes and writes its outputs to the project’s <code>data_rois</code>
directory.</p>
</div>
<div class="section level2">
<h2 id="configuring-extraction">Configuring extraction<a class="anchor" aria-label="anchor" href="#configuring-extraction"></a>
</h2>
<p>ROI extraction is enabled during <code><a href="../reference/setup_project.html">setup_project()</a></code> or
<code><a href="../reference/edit_project.html">edit_project()</a></code>. Once configured, <code><a href="../reference/run_project.html">run_project()</a></code>
will schedule extraction jobs or you can call
<code><a href="../reference/extract_rois.html">extract_rois()</a></code> directly:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://uncdependlab.github.io/BrainGnomes/">BrainGnomes</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/extract_rois.html">extract_rois</a></span><span class="op">(</span></span>
<span>  bold_file <span class="op">=</span> <span class="st">"sub-01_task-rest_desc-clean_bold.nii.gz"</span>,</span>
<span>  atlas_files <span class="op">=</span> <span class="st">"Schaefer400.nii.gz"</span>,</span>
<span>  out_dir <span class="op">=</span> <span class="st">"data_rois"</span>,</span>
<span>  roi_reduce <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>  cor_method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pearson"</span>, <span class="st">"cor.shrink"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="roi-reduction-methods">ROI reduction methods<a class="anchor" aria-label="anchor" href="#roi-reduction-methods"></a>
</h2>
<p>Each atlas region contains many voxels. The <code>roi_reduce</code>
argument controls how those voxel time series are combined into a single
ROI signal:</p>
<ul>
<li>
<strong>mean</strong> – averages all voxels (default).</li>
<li>
<strong>median</strong> – takes the median to reduce sensitivity to
outliers.</li>
<li>
<strong>pca</strong> – extracts the first principal component and
aligns its sign with the mean, capturing the dominant pattern of
variation.</li>
<li>
<strong>huber</strong> – applies a Huber M‑estimator for a robust
trimmed mean.</li>
</ul>
</div>
<div class="section level2">
<h2 id="choosing-correlation-methods">Choosing correlation methods<a class="anchor" aria-label="anchor" href="#choosing-correlation-methods"></a>
</h2>
<p>Connectivity matrices are optional and are governed by the
<code>cor_method</code> argument. Multiple methods may be supplied.
Supported options include:</p>
<ul>
<li>
<strong>pearson</strong> – standard product–moment correlation.</li>
<li>
<strong>spearman</strong> – rank‑based correlation that is robust to
non‑linear but monotonic relationships.</li>
<li>
<strong>kendall</strong> – Kendall’s for ordinal or small sample
data.</li>
<li>
<strong>cor.shrink</strong> – shrinkage estimator from the
<code>corpcor</code> package, useful when the number of ROIs is large
relative to the number of time points.</li>
</ul>
<p>The <code>rtoz</code> flag applies Fisher’s
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math>
transform to correlations, producing unbounded values better suited for
group analysis.</p>
</div>
<div class="section level2">
<h2 id="output-files-and-naming">Output files and naming<a class="anchor" aria-label="anchor" href="#output-files-and-naming"></a>
</h2>
<p>Outputs are organised by atlas within
<code>data_rois/&lt;atlas_name&gt;/</code>. Filenames use extended BIDS
entities: the atlas appears as <code>rois-&lt;Atlas&gt;</code> and
correlation methods are labelled <code>cor-&lt;method&gt;</code>. For
example:</p>
<pre><code>sub-01_task-rest_desc-clean_rois-Schaefer400_timeseries.tsv
sub-01_task-rest_desc-clean_rois-Schaefer400_cor-pearson_connectivity.tsv</code></pre>
<p>These naming conventions ensure that time‑series and connectivity
files can be matched to their originating runs and analysis choices.</p>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p><code><a href="../reference/extract_rois.html">extract_rois()</a></code> provides a flexible way to derive ROI
signals and functional connectivity from postprocessed fMRI data. By
selecting appropriate reduction and correlation methods, you can tailor
ROI analyses to the needs of your study.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Michael Hallquist.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
