% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/postprocess_subject.R
\name{postprocess_subject}
\alias{postprocess_subject}
\title{Postprocess a single fMRI BOLD image using a configured pipeline}
\usage{
postprocess_subject(in_file, cfg = NULL)
}
\arguments{
\item{in_file}{Path to a subject-level BOLD NIfTI file output by fMRIPrep.}

\item{cfg}{A list containing configuration options, including TR (\code{cfg$tr}), enabled processing steps (\verb{cfg$<step>$enable}),
logging (\code{cfg$log_file}), and paths to resources such as singularity images (\code{cfg$fsl_img}). A whole-brain mask is
automatically generated using \code{automask()} and used for relevant processing steps.}
}
\value{
The path to the final postprocessed BOLD NIfTI file. Side effects include writing a confounds TSV file (if enabled),
and logging to a subject-level log file.
}
\description{
Applies a sequence of postprocessing operations to a single subject-level BOLD NIfTI file, as specified by
the user-defined configuration object. Operations may include brain masking, spatial smoothing, ICA-AROMA denoising,
temporal filtering, confound regression, and intensity normalization. The function also optionally computes and saves
a filtered confounds file for downstream analyses.
}
\details{
The processing sequence can be enforced by the user (\code{force_processing_order = TRUE}) or determined dynamically based
on the \code{enable} flags in the configuration. Intermediate NIfTI and confound files are staged in a scratch workspace
(under \code{cfg$scratch_directory}) and final outputs are written or moved to the postprocessing output directory. Logging is
handled via the \code{lgr} package and is directed to subject-specific log files inferred from BIDS metadata.

Required \code{cfg} entries:
\itemize{
\item \code{tr}: Repetition time in seconds.
\item \code{bids_desc}: A BIDS-compliant \code{desc} label for the output filename.
\item \code{processing_steps}: Optional character vector specifying processing order (if \code{force_processing_order = TRUE}).
\item \code{scratch_directory}: Optional directory used for staging intermediate files (defaults to \code{tempdir()} if unset).
\item \code{project_name}: Optional project label used to organize scratch workspaces.
}

Optional steps controlled by \verb{cfg$<step>$enable}:
\itemize{
\item \code{apply_mask}
\item \code{spatial_smooth}
\item \code{apply_aroma}
\item \code{temporal_filter}
\item \code{confound_regression}
\item \code{intensity_normalize}
}
}
