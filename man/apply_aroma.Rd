% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/postprocess_functions.R
\name{apply_aroma}
\alias{apply_aroma}
\title{Apply AROMA-based denoising to an fMRI image}
\usage{
apply_aroma(
  in_file,
  out_file,
  mixing_file,
  noise_ics,
  overwrite = FALSE,
  lg = NULL,
  nonaggressive = TRUE
)
}
\arguments{
\item{in_file}{Path to the input 4D NIfTI file.}

\item{out_file}{The full path for the file output by this step}

\item{mixing_file}{Path to the MELODIC mixing matrix (e.g., \code{*_desc-MELODIC_mixing.tsv}).}

\item{noise_ics}{Vector of ICA components to regress out (usually pulled from relevant aroma_timeseries.tsv file).}

\item{overwrite}{Logical; whether to overwrite the output file if it exists.}

\item{lg}{Optional lgr object used for logging messages}

\item{nonaggressive}{Logical; \code{TRUE} (default) performs partial regression to emulate
non-aggressive AROMA. Set to \code{FALSE} for aggressive regression.}
}
\value{
Path to the denoised output NIfTI file. If required files are missing, returns \code{in_file} unmodified.
}
\description{
Performs ICA-AROMA denoising by regressing out identified noise components from an fMRI
time series using the internal \code{lmfit_residuals_4d()} helper. When \code{nonaggressive = TRUE}
(the default) only the unique variance attributable to the specified components is removed,
matching FSL's non-aggressive \code{fsl_regfilt} behavior. Set \code{nonaggressive = FALSE} for
aggressive regression that fully removes the listed components.
}
\keyword{internal}
