% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/RcppExports.R
\name{automask}
\alias{automask}
\title{Create an automatic brain mask from a NIfTI image (Rcpp implementation)}
\arguments{
\item{image}{A \code{RNifti::NiftiImage} object containing a 3D or 4D volume or
file path to a NIfTI object whose mask should be calculated}

\item{outfile}{Optional file path where the resulting mask should be saved as
a NIfTI file. If \code{""} (default), no file is written.}

\item{clfrac}{Fraction of the robust intensity range used to set the clip
level for initial thresholding. Default is 0.5.}

\item{NN}{Neighborhood connectivity used for the largest connected component
search and optional morphology. Options are \code{1} (faces only, 6-neighbor),
\code{2} (faces+edges, 18-neighbor), or \code{3} (faces+edges+corners,
26-neighbor). Default is 2.}

\item{erode_steps}{Number of additional erosions to apply after main mask
construction. Default is 0 (none).}

\item{dilate_steps}{Number of additional dilations to apply after main mask
construction. Default is 0 (none).}

\item{SIhh}{Distance in millimeters below the most superior voxel of the mask
to retain. Voxels inferior to this cutoff are set to zero. Default is 0
(no cutoff).}

\item{peels}{Number of "peel/unpeel" operations (erode then dilate with NN2
neighborhood) applied to remove thin protuberances. Default is 1, matching
AFNI \verb{3dAutomask}.}

\item{fill_holes}{Logical; if \code{TRUE}, interior holes in the mask are
filled using NN=1 connectivity. Default is TRUE.}
}
\value{
A 3D RNifti mask object with dimensions \code{c(nx, ny, nz)} and
values \code{0/1}. If \code{outfile} is provided, the mask is also written to disk as an unsigned
8-bit (\code{DT_UINT8}) NIfTI file.
}
\description{
This function mimics AFNI's \code{3dAutomask} logic to generate a binary
brain mask from a 3D or 4D NIfTI image. If the input is 4D, the time dimension
is collapsed by computing the mean image across frames. A robust clip level
is then estimated, voxels above threshold are retained, and morphological
clean-up steps are applied (largest component, peels, hole-filling, optional
erosion/dilation, optional superior–inferior cutoff).
}
\details{
The processing pipeline is as follows:
\enumerate{
\item Collapse 4D inputs to a 3D mean volume.
\item Compute robust clip threshold and apply initial thresholding.
\item Retain only the largest connected component (NN as specified).
\item Apply AFNI-style peel/unpeel (\code{peels} times, NN2).
\item Optionally fill interior holes.
\item Apply user-specified erosion/dilation steps (NN as specified).
\item Apply optional superior–inferior cutoff (\code{SIhh}).
}
}
\examples{
\dontrun{
  library(RNifti)
  nii <- readNifti("sub-01_task-rest_bold.nii.gz")
  mask <- automask_rcpp(nii, outfile = "sub-01_mask.nii.gz")
}

}
\seealso{
\code{\link[RNifti]{readNifti}}, AFNI \code{3dAutomask}
}
