% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/postprocess_functions.R
\name{lmfit_residuals_mat}
\alias{lmfit_residuals_mat}
\title{Residualize matrix time series using lm()}
\usage{
lmfit_residuals_mat(
  Y,
  X,
  include_rows = NULL,
  add_intercept = FALSE,
  preserve_mean = FALSE,
  set_mean = 0,
  regress_cols = NULL,
  exclusive = FALSE
)
}
\arguments{
\item{Y}{Numeric matrix of time series to residualize (rows = timepoints, columns = signals).}

\item{X}{Numeric design matrix with the same number of rows as \code{Y}.}

\item{include_rows}{Optional logical vector marking rows to use during fitting.}

\item{add_intercept}{Logical; add an intercept column when the design lacks one.}

\item{preserve_mean}{Logical; keep the original mean of uncensored timepoints.}

\item{set_mean}{Numeric; shift residuals so every column has this mean (ignored when \code{preserve_mean = TRUE}).}

\item{regress_cols}{Optional integer vector (1-based) selecting columns of \code{X} to regress out.}

\item{exclusive}{Logical; if \code{TRUE}, the fit only uses columns listed in \code{regress_cols}
(and the intercept, if present).}
}
\value{
A numeric matrix of residuals with the same dimensions as \code{Y}.
}
\description{
Applies the same confound regression logic as \code{lmfit_residuals_4d} but operates on an
in-memory matrix rather than a NIfTI image on disk. Each column of \code{Y} is treated as a
separate time series, and nuisance regressors supplied in \code{X} are regressed out using
\code{stats::lm.fit()} on the uncensored timepoints.
}
\details{
Constant columns in the design matrix are removed automatically (with the first intercept
column preserved). Optional censoring allows the fit to use only valid rows while predictions
are generated for the full series.
}
\seealso{
lmfit_residuals_4d
}
\keyword{internal}
