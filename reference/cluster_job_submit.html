<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>This function submits a single script to a high-performance cluster using a scheduler (Slurm or TORQUE). It accepts a vector of arguments to be passed to the scheduler and a vector of environment variables that should be passed to the compute node at job execution. — cluster_job_submit • BrainGnomes</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="This function submits a single script to a high-performance cluster using a scheduler (Slurm or TORQUE). It accepts a vector of arguments to be passed to the scheduler and a vector of environment variables that should be passed to the compute node at job execution. — cluster_job_submit"><meta name="description" content="The function returns the jobid of the scheduled job."><meta property="og:description" content="The function returns the jobid of the scheduled job."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">BrainGnomes</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.7-2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/braingnomes_quickstart.html">BrainGnomes Quickstart</a></li>
    <li><a class="dropdown-item" href="../articles/building_containers.html">Building Singularity containers for BrainGnomes</a></li>
    <li><a class="dropdown-item" href="../articles/extract_rois.html">Extracting ROI Timeseries and Connectivity</a></li>
    <li><a class="dropdown-item" href="../articles/postprocessing.html">BrainGnomes Postprocessing Walkthrough</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/UNCDEPENdLab/BrainGnomes/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>This function submits a single script to a high-performance cluster using a scheduler (Slurm or TORQUE). It accepts a vector of arguments to be passed to the scheduler and a vector of environment variables that should be passed to the compute node at job execution.</h1>
      <small class="dont-index">Source: <a href="https://github.com/UNCDEPENdLab/BrainGnomes/blob/0.7-2/R/hpc_functions.R" class="external-link"><code>R/hpc_functions.R</code></a></small>
      <div class="d-none name"><code>cluster_job_submit.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The function returns the jobid of the scheduled job.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">cluster_job_submit</span><span class="op">(</span></span>
<span>  <span class="va">script</span>,</span>
<span>  scheduler <span class="op">=</span> <span class="st">"slurm"</span>,</span>
<span>  sched_args <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  env_variables <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  export_all <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  echo <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  fail_on_error <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  wait_jobs <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  wait_signal <span class="op">=</span> <span class="st">"afterok"</span>,</span>
<span>  repolling_interval <span class="op">=</span> <span class="fl">60</span>,</span>
<span>  tracking_sqlite_db <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  tracking_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-script">script<a class="anchor" aria-label="anchor" href="#arg-script"></a></dt>
<dd><p>A path to a script that should be executed by the scheduler or a single command to be run. When
<code>script</code> does not point to an existing file, it is treated as a one-line command to execute. In the case of
conflicts, the directives passed with <code>sched_args</code> will take precedence.</p></dd>


<dt id="arg-scheduler">scheduler<a class="anchor" aria-label="anchor" href="#arg-scheduler"></a></dt>
<dd><p>Which scheduler to use for job submission. Options are 'qsub', 'torque', 'sbatch', 'slurm', or 'sh'.
The terms 'qsub' and 'torque' are aliases (where 'torque' submits via the qsub command). Likewise for 'sbatch'
and 'slurm'. The scheduler 'sh' does not submit to any scheduler at all, but instead executes the command
immediately via sh.</p></dd>


<dt id="arg-sched-args">sched_args<a class="anchor" aria-label="anchor" href="#arg-sched-args"></a></dt>
<dd><p>A character vector of arguments to be included in the scheduling command. On TORQUE, these
will typically begin with '-l' such as '-l wall_time=10:00:00'.</p></dd>


<dt id="arg-env-variables">env_variables<a class="anchor" aria-label="anchor" href="#arg-env-variables"></a></dt>
<dd><p>A named character vector containing environment variables and their values to be passed
to the <code>script</code> at execution time. This is handled by the '-v' directive on TORQUE clusters and
by '–export' on Slurm clusters. The names of this vector are the environment variable names and
the values of the vector are the environment variable values to be passed in.
If you want to propagate the current value of an environment variable to the compute node at runtime,
use NA as the value of the element in <code>env_variables</code>. See examples.</p></dd>


<dt id="arg-export-all">export_all<a class="anchor" aria-label="anchor" href="#arg-export-all"></a></dt>
<dd><p>Whether to export all environment variables to the compute node at runtime. Default: FALSE</p></dd>


<dt id="arg-echo">echo<a class="anchor" aria-label="anchor" href="#arg-echo"></a></dt>
<dd><p>Whether to echo the job submission command to the terminal at the time it is scheduled. Default: TRUE.</p></dd>


<dt id="arg-fail-on-error">fail_on_error<a class="anchor" aria-label="anchor" href="#arg-fail-on-error"></a></dt>
<dd><p>Whether to stop execution of the script (TRUE), or issue a warning (FALSE) if the job
submission fails. Defaults to FALSE (i.e., issue a warning).</p></dd>


<dt id="arg-wait-jobs">wait_jobs<a class="anchor" aria-label="anchor" href="#arg-wait-jobs"></a></dt>
<dd><p>a character string of jobs or process ids that should complete before this job is executed</p></dd>


<dt id="arg-wait-signal">wait_signal<a class="anchor" aria-label="anchor" href="#arg-wait-signal"></a></dt>
<dd><p>on torque or slurm clusters, the signal that should indicate that parent jobs have finished.</p></dd>


<dt id="arg-repolling-interval">repolling_interval<a class="anchor" aria-label="anchor" href="#arg-repolling-interval"></a></dt>
<dd><p>The number of seconds to wait before rechecking job status (used only for local scheduler)</p></dd>


<dt id="arg-tracking-sqlite-db">tracking_sqlite_db<a class="anchor" aria-label="anchor" href="#arg-tracking-sqlite-db"></a></dt>
<dd><p>Path to a SQLite database used for job tracking. If provided, job submission metadata
will be recorded, including job dependencies and parent-child relationships.</p></dd>


<dt id="arg-tracking-args">tracking_args<a class="anchor" aria-label="anchor" href="#arg-tracking-args"></a></dt>
<dd><p>A named list of metadata fields to track about the submitted job. This may include the parent job ID,
batch script path, and scheduler options. This is used in conjunction with <code>tracking_sqlite_db</code> to support job tracking.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A character string containing the jobid of the scheduled job.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Michael Hallquist</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span>  <span class="co">#simple PBS submission</span></span></span>
<span class="r-in"><span>  <span class="fu">cluster_job_submit</span><span class="op">(</span><span class="st">'myscript.bash'</span>, scheduler<span class="op">=</span><span class="st">"torque"</span>, </span></span>
<span class="r-in"><span>     sched_args<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'-l walltime=10:00:00'</span>, <span class="st">'-l nodes=1:ppn=20'</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>     env_variables<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>RUN_INDEX<span class="op">=</span><span class="fl">2</span>, MODEL_NAME<span class="op">=</span><span class="st">'FSE21'</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">#To forward environment variables without explicitly providing values. Note that these must</span></span></span>
<span class="r-in"><span>  <span class="co">#  be in R's system environment (cf. Sys.getenv) at execution time to forward as expected.</span></span></span>
<span class="r-in"><span>  <span class="fu">cluster_job_submit</span><span class="op">(</span><span class="st">'myscript.sbatch'</span>, scheduler<span class="op">=</span><span class="st">"slurm"</span>,</span></span>
<span class="r-in"><span>     sched_args<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'-p general'</span>, <span class="st">'-N 1'</span>, <span class="st">'-n 12'</span>, <span class="st">'--mem=10g'</span>, <span class="st">'-t 02-00:00:00'</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>     env_variables<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>RUN_INDEX<span class="op">=</span><span class="fl">2</span>, R_HOME<span class="op">=</span><span class="cn">NA</span>, JAVA_HOME<span class="op">=</span><span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># submit a single command without a script file</span></span></span>
<span class="r-in"><span>  <span class="fu">cluster_job_submit</span><span class="op">(</span><span class="st">'echo "hello"'</span>, scheduler<span class="op">=</span><span class="st">"slurm"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Michael Hallquist.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

